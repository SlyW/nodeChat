<!doctype html>
<html lang="en">
	<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>nodeChat</title>
    <link href="../clientCSS/foundation.min.css" rel="stylesheet" type="text/css">
    <link href="../clientCSS/nodeChat.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="/clientJS/jquery-2.1.1.min.js"></script>
		<style type="text/css">
			div#CenterBox {
				position: absolute;
				width: 400px;
				left: 50%;
				margin-left: -200px;
				width: 400px;
			}
			div#Register {
				width: 400px;
				padding: 8px;
				display: inline-block;
			}
			div#Notifications {
				width: 400px;
				margin-top: 4px;
				text-align: left;
				display: inline-block;
			}
		</style>
		<script type="text/javascript">
			$(document).ready(function() {

				$("input#user").keyup(function(event) {
					if (event.keyCode == 13) {
						authorizeUser($("input#user").val());
					}
				});

				$("button#Authorize").click(function() {
					authorizeUser($("input#user").val());
				});

				notify("Ready.", true);
			});

			function authorizeUser(user) {
				var authPromise = $.post("./auth/" + user, function(data) { } )
					.done(function (data) {
						window.location.href = "/msgs/" + data._id;
					})
					.fail(function (data) {
						notifyError(data.responseText, true);
					})
			}

      function notify(msg, clear) {
        if (clear) {
          $("div#Notifications").empty();
        }
        $("div#Notifications")
          .append($("<div class='alert-box success'></div>")
          .html(msg));
      }
      function notifyError(msg, clear) {
        if (clear) {
          $("div#Notifications").empty();
        }
        $("div#Notifications")
          .append($("<div class='alert-box alert'></div>")
          .html(msg));
      }
		</script>
	</head>
	<body>
		<div id="CenterBox">
			<h1>nodeChat <span class="version">0.1</span></h1>
			<div id="Register">
				<input type="text" id="user" name="user" placeholder="Desired username">
				<button id="Authorize" role="button">Enter Chat Room</button>
			</div>
			<hr />
			<div id="Notifications"><div>
		</div>
	</body>
</html>
